{% extends "dashboard/base.html" %}
{% block title %}Mapa â€“ WIS{% endblock %}

{% block content %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<div id="map" style="height: 520px;"></div>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([-7.12, -34.86], 11);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 19, attribution: '&copy; OpenStreetMap'
  }).addTo(map);

  fetch('/api/warrants/?format=json&page_size=500')
    .then(r => r.json())
    .then(data => {
      const results = data.results || data;
      results.forEach(w => {
        if (w.lat && w.lon) {
          L.marker([w.lat, w.lon]).addTo(map)
            .bindPopup(`<b>${w.number}</b><br>${w.person.name}<br>Status: ${w.status}`);
        }
      });
    })
    .catch(console.error);
</script>
{% endblock %}
